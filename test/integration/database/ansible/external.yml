---
- name: "External"
  hosts: all
  become: true
  tasks:
    - include_vars:
        dir: ../../../../.kitchen/
        files_matching: 'database-replicate.*.yml'
        name: primary
    - wait_for:
        host: "{{ primary.hostname }}"
        port: 443
    - name: install key
      manageiq_key:
        fetch_key: true
        hostname: "{{ primary.hostname }}"
        sshlogin: root
        sshpassword: smartvm
    - name: connect to database
      manageiq_database:
        state: external
        region: 0
        username: root 
        password: smartvm
        hostname: "{{ primary.hostname }}"
    - name: wait for initialization to finish
      wait_for:
        port: 443
